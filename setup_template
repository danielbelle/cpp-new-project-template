#!/bin/bash
# Script de configuraÃ§Ã£o manual para template Git
# Execute manualmente apÃ³s o clone: ./setup_template

echo ""
echo "=== ğŸš€ CONFIGURANDO TEMPLATE AUTOMATICAMENTE ==="
echo ""

# Obter nome da pasta atual (projeto)
PROJECT_NAME=$(basename "$PWD")
echo "ğŸ“ Nome da pasta detectado: $PROJECT_NAME"

# FunÃ§Ã£o para sanitizar nome
sanitize_name() {
    echo "$1" | sed -E 's/[[:space:]_]+/-/g' | sed -E 's/[^a-zA-Z0-9-]//g' | tr '[:upper:]' '[:lower:]' | sed -E 's/--+/-/g' | sed -E 's/^-//' | sed -E 's/-$//'
}

SANITIZED_NAME=$(sanitize_name "$PROJECT_NAME")

if [ "$SANITIZED_NAME" != "$PROJECT_NAME" ]; then
    echo "ğŸ”§ Nome sanitizado: $SANITIZED_NAME"
fi

# Perguntar se deseja cadastrar descriÃ§Ã£o do projeto
PROJECT_DESCRIPTION="Template projeto em C++"
echo ""
read -p "ğŸ“ Deseja cadastrar uma descriÃ§Ã£o para o projeto? (s/N): " cadastrar_desc

if [[ $cadastrar_desc =~ [sS] ]]; then
    read -p "Digite a descriÃ§Ã£o do projeto: " nova_descricao
    if [ -n "$nova_descricao" ]; then
        PROJECT_DESCRIPTION="$nova_descricao"
        echo "âœ… DescriÃ§Ã£o definida: $PROJECT_DESCRIPTION"
    else
        echo "âš ï¸  DescriÃ§Ã£o vazia, mantendo padrÃ£o"
    fi
else
    echo "â„¹ï¸  Mantendo descriÃ§Ã£o padrÃ£o"
fi

echo "ğŸ”„ Atualizando arquivos de configuraÃ§Ã£o..."

# Atualizar CMakeLists.txt - APENAS a linha set(PROJECT_NAME)
if [ -f "CMakeLists.txt" ]; then
    # Atualizar apenas a linha especÃ­fica do PROJECT_NAME
    sed -i.tmp -E "s/^(set\\(PROJECT_NAME \")[^\"]+(\"\\))$/set(PROJECT_NAME \"${SANITIZED_NAME}\")/" CMakeLists.txt
    
    # Atualizar a descriÃ§Ã£o do projeto
    sed -i.tmp -E "s/^(set\\(PROJECT_DESCRIPTION \")[^\"]+(\"\\))$/set(PROJECT_DESCRIPTION \"${PROJECT_DESCRIPTION}\")/" CMakeLists.txt
    
    rm -f CMakeLists.txt.tmp 2>/dev/null
    echo "âœ… CMakeLists.txt configurado"
fi

# Atualizar script run
if [ -f "run" ]; then
    sed -i.tmp -E "s/(PROJECT_NAME=\")[^\"]+(\")/\1${SANITIZED_NAME}\2/" run
    rm -f run.tmp 2>/dev/null
    echo "âœ… Script 'run' configurado para projeto: ${SANITIZED_NAME}"
    chmod +x "run"
fi

# ğŸ”¥ REMOVER CONEXÃƒO COM REPOSITÃ“RIO TEMPLATE (ÃšLTIMO PASSO)
echo ""
echo "ğŸ”„ Desanexando do repositÃ³rio template..."
rm -rf .git
git init
echo "âœ… Novo repositÃ³rio Git inicializado"

# Remover este script apÃ³s execuÃ§Ã£o
rm -f "$0"

echo ""
echo "ğŸ‰ CONFIGURAÃ‡ÃƒO AUTOMÃTICA CONCLUÃDA!"
echo "ğŸ“‹ PrÃ³ximos passos:"
echo "   1. Configure o repositÃ³rio remoto:"
echo "      git remote add origin <seu-novo-repositorio-url>"
echo "   2. Primeiro commit:"
echo "      git add . && git commit -m 'Initial commit from template'"
echo "   3. Push inicial:"
echo "      git push -u origin main"
echo "   4. Teste o projeto:"
echo "      ./run"
echo ""